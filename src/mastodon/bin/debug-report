#!/bin/bash -e

. "$SNAP/acme.env"
. "$SNAP/imagemagick.env"
. "$SNAP/logrotate.env"
. "$SNAP/mastodon.env"
. "$SNAP/nginx.env"
. "$SNAP/postgres.env"
. "$SNAP/redis.env"
. "$SNAP/snap.env"

border_text "=" "Debug report for snap version $(cat "$SNAP_COMMON/version")"

echo
underline_text "=" Settings
echo

snap get mastodon-server -d

echo
underline_text "=" Files
echo

find "/var/snap/$SNAP_NAME" -maxdepth 3 | sed -e "s|^/var/snap/$SNAP_NAME/||" -e '2,$s|[^/]*/|  |g'

echo
underline_text "=" Environment
echo

load_postgres_tuning_env
load_nginx_tuning_env
load_backend_tuning_env
load_sidekiq_tuning_env
load_streaming_tuning_env

printenv

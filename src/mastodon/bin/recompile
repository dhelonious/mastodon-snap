#!/bin/bash -e

. "$SNAP/mastodon.env"

if [ "$(snapctl get recompile-required)" == true ]; then
    mkdir_as_daemon_user "$YARN_CACHE_FOLDER"
    cd "$MASTODON_DIR" && mastodon_rails assets:precompile && mastodon_rails log:clear tmp:clear
    reset_recompile_required
fi

#!/bin/bash -e

. "$SNAP/mastodon.env"
. "$SNAP_CURRENT/server.conf"

check_setup
postgres_waitready
redis_waitready
load_sidekiq_tuning_env
migrations_waitready

export DB_POOL=${SIDEKIQ_DB_POOL:-25}

mastodon_sidekiq -c $DB_POOL \
    2>&1 | tee -a "$LOG_DIR/sidekiq.log"

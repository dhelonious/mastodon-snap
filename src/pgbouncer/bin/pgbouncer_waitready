#!/bin/bash -e

. "$SNAP/postgres.env"
. "$SNAP/pgbouncer.env"

count=${1:-10}

while [ "$count" -gt 0 ]; do
    if psql_exec "host=localhost port=$PGB_PORT user=$PGB_USER password=$PGB_PASSWORD dbname=pgbouncer" -c "SHOW POOLS;" > /dev/null; then
        exit 0
    fi
    echo Waiting for pgbouncer...
    sleep 1
    count=$((count-1))
done

echo_error Pgbouncer is not running
exit 1

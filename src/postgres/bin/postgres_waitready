#!/bin/bash -e

. "$SNAP/postgres.env"

count=${1:-10}

while [ "$count" -gt 0 ]; do
    if run_as_daemon_user test -f "$PG_SOCK_DIR/.s.PGSQL.5432" && \
        pg_isready -h "$PG_SOCK_DIR" -U postgres > /dev/null
    then
        exit 0
    fi
    sleep 1
    count=$((count-1))
done

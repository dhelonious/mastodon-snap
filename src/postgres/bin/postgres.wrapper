#!/bin/bash -e

. "$SNAP/postgres.env"

postgres_upgrade_waitready

if ! $(config_exists postgres postgresql.conf); then
    echo "Postgres is not yet configured"
    exit 0
fi

mkdir_pid
mkdir_sock
mkdir -p "$PG_SOCK_DIR"

postgres \
    -D "$PG_DATA" \
    -k "$PG_SOCK_DIR" \
    -h "" \
    2>&1 | tee -a "$PG_LOG_FILE"

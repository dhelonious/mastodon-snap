#!/bin/bash -e

. "$SNAP/postgres.env"

if is_active postgres; then
    echo Postgres is running, try to stop it
    snapctl stop "$SNAP_NAME.postgres"
fi

if pg_version_changed; then
    echo Update postgres data
    run_as_daemon_user rm -rf "$PG_DATA"
    run_as_daemon_user mkdir -pm 0700 "$PG_DATA"
    run_as_daemon_user initdb.wrapper
    enable_postgres_config
fi

name: build
run-name: Build snap
inputs:
  tag:
    required: false
    type: string
  publish:
    required: false
    type: boolean
  release:
    required: false
    type: string
  SNAPCRAFT_STORE_CREDENTIALS:
    required: false
    type: string
outputs:
  snap:
    value: ${{ steps.build.outputs.snap }}
runs:
  using: composite
  steps:
  - uses: actions/checkout@v4
    with:
      ref: ${{ inputs.tag }}
  - uses: snapcore/action-build@v1
    id: build
  - uses: actions/upload-artifact@v4
    with:
      name: ${{ steps.build.outputs.snap }}
      path: ${{ steps.build.outputs.snap }}
      retention-days: 1
      overwrite: true
  - uses: actions/checkout@v4
    with:
      ref: ${{ github.ref }}
  - uses: actions/download-artifact@v4
    with:
      name: ${{ steps.build.outputs.snap }}
  - uses: snapcore/action-publish@v1
    if: ${{ inputs.publish }}
    env:
      SNAPCRAFT_STORE_CREDENTIALS: ${{ inputs.SNAPCRAFT_STORE_CREDENTIALS }}
    with:
      snap: ${{ steps.build.outputs.snap }}
      release: ${{ inputs.release || 'latest/edge' }}
